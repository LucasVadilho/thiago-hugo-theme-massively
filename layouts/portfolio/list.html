{{ partial "htmlhead" . }}

<body lang='{{ .Site.LanguageCode | default "en-us" }}' class="is-preload">
    
    <div id="wrapper">
        {{ partial "header" . }}
        {{ partial "nav" . }}
        <span id="closeProj" class="fa fa-times-circle fa-2x" aria-hidden="true" onclick="closeSnackbarProj()">
            <span class="closeButtonBackground" id="insideCloseProj"></span>
        </span>
        <div id="blackout2"></div>
        <a href="#navPanel" id="navPanelToggle">{{ i18n "NAV_MENU" . }}</a>
        
        <div id="main">
            <div id="conteudo">

                <div id="snackbarFiltro"> 
                    <a id="abrir" class='goToClass' onclick="openBar()">Seção &#10095;</a>
                    <a id="fechar" class='goToClass' onclick="closeBar()">Seção &#10094;</a>
                    <a id="goToIlustracoes" class='goToClass' onclick="goToPosition(id)">Ilustrações</a>
                    <a id="goToCapas" class='goToClass' onclick="goToPosition(id)">Capas de Livros</a>
                </div>
                
                <div id="projetos-list-ilustracoes">
                    <h1>Ilustrações</h1>
                        <div id="projetos-organizer">
                            {{ range where .Pages.ByDate "Params.categoriaprojeto" "Ilustrações" }}
                                <div class="projeto-container">
                                    <div id="{{ .Params.Titleprojeto }}" 
                                         class="img-crop" 
                                         onclick="abrirproj(event,'{{ .Params.Titleprojeto }}')"
                                         itens="{{ jsonify .Params.Itens }}">
                                        <img src="{{ .Params.Thumbprojeto }}">
                                    </div>           
                                </div> 
                            {{ end }}
                        </div>
                </div>

                <div id="projetos-list-capas">
                    <h1>Capas de Livros</h1>
                    <div id="projetos-organizer">
                        {{ range where .Pages.ByDate "Params.categoriaprojeto" "Capas de Livros" }}
                            <div class="projeto-container">
                                <div id="{{ .Params.Titleprojeto }}" 
                                     class="img-crop" 
                                     onclick="abrirproj(event,'{{ .Params.Titleprojeto }}')"
                                     itens="{{ jsonify .Params.Itens }}">
                                    <img src="{{ .Params.Thumbprojeto }}">
                                </div>
                                        
                            </div> 
                        {{ end }}
                    </div>
                </div>

                <div id="blackout"></div>
                <div id="containerProj">
                    <div id="snackbarProj"></div>
                </div>  
            </div>
        </div>
        {{- partial "copyright" . }}  
    </div>
    {{- template "_internal/google_analytics.html" . }}
    {{- partial "scripts/index" . }}
    
</body>

<style>
    a{
        border: none;
    }

    h1{
        font-size: 3rem;
    }

    #blackout{
        position: absolute;
        top: 0;
        bottom: 0;
        right: 0;
        left: 0;
        background-color: rgba(0, 0, 0, 0.801);
        display: none;
        z-index: 3;
        pointer-events: none;
    }

    #blackout2{
        position: absolute;
        top: 0;
        bottom: 0;
        right: 0;
        left: 0;
        background-color: rgba(0, 0, 0, 0.801);
        display: none;
        z-index: 2;
        pointer-events: none;
    }

    body.outsideSnackProj{
        cursor: zoom-out;
    }

    body.insideSnackProj{
        cursor: zoom-in;
    }

    body.normal{
        cursor: default;
    }

/* ORGANIZA OS TIPOS */
   #projetos-list-ilustracoes{
        text-align: center;
   }                        

   #projetos-list-capas{
        text-align: center;
        margin-top: 40px;
    }

    /* ORGANIZA O FILTRO DOS PROJETOS */
    #snackbarFiltro{
        background-color: rgba(255, 255, 255, 0.875);
        box-shadow: 0 0.125rem 0.75rem 0 rgba(30, 37, 45, 0.25);
        color: #212931;
        position: fixed;
        bottom: 0.75rem;
        left: 0.75rem;
        border: 0;
        font-family: "Source Sans Pro";
        font-size: 0.9rem;
        font-weight: bold;
        letter-spacing: 0.075em;
        padding: 0.375rem 1.25rem;
        text-transform: uppercase;
        z-index: 5;
        width: 103px;
        margin: auto;
        height: 41px;
        overflow: hidden;
        display: block;
        -webkit-touch-callout:none;
        -webkit-user-select:none;
        -khtml-user-select:none;
        -moz-user-select:none;
        -ms-user-select:none;
        user-select:none;
    }

    #fechar{
        display: none;
    }

    #abrir{
        display: block;
    }
    
    .goToClass:hover{
        cursor: pointer;
    }

    .goToClass{
        margin-right: 10px;
    }

    /* ORGANIZA OS PROJETOS DENTRO DOS TIPOS */
    #projetos-organizer{
        width: 100%;
        justify-content: center;
        display: inline-flex;
        flex-direction: row;
        flex-wrap: wrap;
        margin-top: -20px;
    }

    .projeto-container{
        margin-right: 10px;
        margin-left: 10px;
        margin-top: 20px;
    }

    .img-crop{
        margin: 0;
        position: relative;
        width: 220px;
        height: 220px;
        overflow: hidden;
    }

    .img-crop img{
        width: 100%;
        object-fit: cover;
        object-position: 50% 50%;
        position: relative;
        height: 100%;
        transition: transform .2s;
    }

    .img-crop img:hover{
        cursor: pointer;
        transform: scale(1.2);
        transition: transform .2s;
    }

    .projeto-nome{
        text-align: center;
        margin-bottom: 0;
    }

/* SNACKBAR PROJETO OPEN */
    #snackbarProj {
        display: none;
        padding: 12px;
        border-radius: 2px;
        position: fixed;
        background-color: rgb(255 255 255 / 88%);
        transform: translate(-50%,0);
        left: 50%;
        z-index: 8;
        overflow: auto;
        width: calc(100% - 2rem);
        max-width: 1051px;
    }

    #closeProj:hover{
        cursor: pointer;
        color: #18bfef; 
    }

    #closeProj{
        position: absolute;
        color: rgb(255 255 255 / 88%);
        text-align: center;
        display: none;
        z-index: 10; 
        visibility: visible;
        transition: visibility 1s ease-in-out;
    }

    .closeButtonBackground{
        background-color: #838383;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        position: absolute;
        top: 4.5px;
        left: 2px;
        z-index: -1;
        visibility: visible;
        transition: visibility 1s ease-in-out;
    }

    .iframecontainer{
        position: relative;
        overflow: hidden;
        width: 100%;
        padding-top: 56.25%; /* 16:9 Aspect Ratio (divide 9 by 16 = 0.5625) */
    }

    .iframecontainer iframe{
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        width: 100%;
        height: 100%;
        border: none;
    }

    #copyright{
        z-index:1;
    }

    /* IMAGEM ON FOCUS */
    .zoomedContainer {
        display: flex;
        flex-direction: column;
        justify-content: center;
        width: 100vw;
        height: 100vh;
        position: fixed;
        z-index: 9;
        background-color: #000;
    }

    .zoomedObject {
        object-fit: contain;
        max-height: calc(100vh - 40px);
        max-width: max-content;
    }

    .hide{
        visibility: hidden;
    }
    
/* DEFINICOES PARA OS TAMANHOS EM DESKTOP */
    @media screen and (min-width: 1120px){
        .img-crop{
            width: 210px;
            height: 210px;
        }
    }

    @media screen and (max-width: 1119px) and (min-width: 1061px){
        .img-crop{
            width: 200px;
            height: 200px;
        }
    }

    @media screen and (max-width: 1060px) and (min-width: 1041px){
        .img-crop{
            width: 195px;
            height: 195px;
        }
    }

    @media screen and (max-width: 1040px) and (min-width: 1021px){
        .img-crop{
            width: 190px;
            height: 190px;
        }
    }

    @media screen and (max-width: 1020px) and (min-width: 981px){
        .img-crop{
            width: 180px;
            height: 180px;
        }
    }

    @media screen and (max-width: 980px) and (min-width: 941px) {
        .img-crop{
            width: 170px;
            height: 170px;
        }
    }

    @media screen and (max-width: 940px) and (min-width: 872px) {
        .img-crop{
            width: 210px;
            height: 210px;
        }
    }

    @media screen and (max-width: 872px) and (min-width: 841px) {
        .img-crop{
            width: 200px;
            height: 200px;
        }
    }

    @media screen and (max-width: 840px) and (min-width: 810px) {
        .img-crop{
            width: 190px;
            height: 190px;
        }
    }

    @media screen and (max-width: 736px) and (min-width: 603px){
        #conteudo{
            padding: 3rem 2rem 3rem 2rem;
        }
        h1{
            font-size: 2.8rem;
        }
    }

    @media screen and (max-width: 602px) and (min-width: 543px){
        #conteudo{
            padding: 3rem 2rem 3rem 2rem;
        }
        h1{
            font-size: 2.8rem;
        }
        .img-crop{
            width: 190px;
            height: 190px;
        }
    }

    @media screen and (max-width: 543px){
        #conteudo{
            padding: 3rem 2rem 3rem 2rem;
        }
        h1{
            font-size: 2.8rem;
        }
        .img-crop{
            width: 165px;
            height: 165px;
        }
    }

    
/* DEFINICOES PARA OS TAMANHOS EM MOBILE */
    @media only screen and (hover:none) and (pointer:coarse) and (max-width: 736px) and (min-width: 425px){
        #conteudo{
            padding: 3rem 2rem 3rem 2rem;
        }
        h1{
            font-size: 2.8rem;
        }
        .img-crop{
            width: 160px;
            height: 160px;
        }
    }

    @media only screen and (hover:none) and (pointer:coarse){
        #snackbarProj{
            width: calc(100% - 3rem);
        }
    }
    
    @media screen and (max-width: 424px) and (min-width: 375px){
        #conteudo{
            padding: 3rem 2rem 3rem 2rem;
        }
        h1{
            font-size: 2.3rem;
        }
        .img-crop{
            width: 140px;
            height: 140px;
        }
        .projeto-container{
            margin-right: 7px;
            margin-left: 7px;
            margin-top: 14px;
        }
    }
    @media screen and (max-width: 374px){
        #conteudo{
            padding: 3rem 2rem 3rem 2rem;
        }
        h1{
            font-size: 2rem;
        }
        .img-crop{
            width: 118px;
            height: 118px;
        }
        .projeto-container{
            margin-right: 7px;
            margin-left: 7px;
            margin-top: 14px;
        }
        #snackbarFiltro{
            background-color: rgba(255, 255, 255, 0.875);
            box-shadow: 0 0.125rem 0.75rem 0 rgba(30, 37, 45, 0.25);
            color: #212931;
            position: fixed;
            bottom: 5rem;
            left: 0.75rem;
            border: 0;
            font-family: "Source Sans Pro";
            font-size: 0.8rem;
            font-weight: bold;
            letter-spacing: 0.075em;
            padding: 0.375rem 1.25rem;
            text-transform: uppercase;
            z-index: 5;
            width: 103px;
            margin: auto;
            max-height: 35px;
            overflow: hidden;
            display: block;
            -webkit-touch-callout:none;
            -webkit-user-select:none;
            -khtml-user-select:none;
            -moz-user-select:none;
            -ms-user-select:none;
            user-select:none;
        }
    }
               
/* DEFINICOES PARA OS TAMANHOS DE DEVICE MOBILE */
    /* Definicoes para celular */
    @media only screen and (hover:none) and (pointer:coarse) and (max-width:450px) and (min-width:321px){
    }
</style>

<script type="text/javascript">
    let toClose = []

    let navPanelToggle = document.getElementById("navPanelToggle")

    let closeIcon = document.getElementById("closeProj")
    let closeIconInside = document.getElementById("insideCloseProj")

    let snackbarProj = document.getElementById("snackbarProj")
    let flagProjAberto = false
    let dark = document.getElementById('blackout')
    let dark2 = document.getElementById('blackout2')
    let snackbarCssStyle
    
    let setupMouseover = function(){
        document.getElementById('ssssss').addEventListener('mouseover', () => {
            document.body.className = 'insideSnackProj'
        })
        
        document.getElementById('ssssss').addEventListener('mouseout', () => {
            document.body.className = 'normal'  
        })
    }

    let abrirproj = function (e, id){
        console.log('abrirproj')
        e.stopPropagation()

        toClose = 'projeto'

        flagProjAberto = true
        checkFlag()

        openProject = "<div id='ssssss'>"

        snackbarProj.style.display = "block"
        closeIcon.style.display = 'block'

        document.body.style.cssText = 'overflow: hidden'

        let itens = JSON.parse(document.getElementById(id).getAttribute('itens'))
        
        for (let item of itens){
            if (item.type == 'image'){
                openProject += '<img src="' + item.src + '" style="display:block" class="snackZoom"/>'
            } else {
                openProject += '<div class="iframecontainer"><iframe src="' + item.src + '" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" frameorder="0" vspace="0" hspace="0" marginwidth="0" marginheight="0" width="100%" style="margin: 0 0 0 0" frameBorder="0" scrolling="no" style="border: 0px" allowfullscreen></iframe></div>'
            } 
        }

        openProject += "</div>"

        snackbarProj.innerHTML = openProject

        setupMouseover()

        /* checa o tamanho do content para ajustar a height da snackbar */
        let closeIconProj = document.getElementById("closeProj")
        let rect = snackbarProj.getBoundingClientRect()
        if (snackbarProj.scrollHeight <= window.innerHeight){
            var topOffSet = ((window.innerHeight - snackbarProj.scrollHeight)/2)
            snackbarProj.style.top = topOffSet + "px"
            closeIcon.style.top = ((topOffSet + window.pageYOffset + 28)+ "px")
            closeIcon.style.left = (((rect.x + rect.width) - 50 ) + "px")
            let snackbarCssStyle = snackbarProj.style.cssText 
        }else{
            snackbarProj.style.bottom = "10px"
            snackbarProj.style.top = "10px"
            closeIcon.style.top = (window.pageYOffset + 28) + "px"
            closeIcon.style.left = (((rect.x + rect.width) - 50 ) + "px")
            let snackbarCssStyle = snackbarProj.style.cssText 
        }   

        window.addEventListener('resize', function(c){
            let rect = snackbarProj.getBoundingClientRect()
            if (snackbarProj.scrollHeight <= window.innerHeight){
                var topOffSet = ((window.innerHeight - snackbarProj.scrollHeight) / 2)
                snackbarProj.style.top = topOffSet + "px"
                snackbarProj.style.removeProperty('bottom')
                closeIcon.style.top = ((topOffSet + window.pageYOffset + 28) + "px")
                closeIcon.style.left = (((rect.x + rect.width) - 50 ) + "px")
                let snackbarCssStyle = snackbarProj.style.cssText   
            }else{
                snackbarProj.style.bottom = "10px"
                snackbarProj.style.top = "10px"
                closeIcon.style.top = (window.pageYOffset + 28) + "px"
                closeIcon.style.left = (((rect.x + rect.width) - 50 ) + "px")
                let snackbarCssStyle = snackbarProj.style.cssText 
        }
        })

        dark.style.display= "block"
        dark2.style.display= "block"
        setTimeout("hideIconVisibility()", 3000)

        // window.addEventListener('click', function(b){
        //     if (!document.getElementById('snackbarProj').contains(b.target)){
        //         close()
        //     }
        // }, options = {"once": true})

        // document.addEventListener("keydown", function(c){
        //     console.log('esc proj')
        //     if(c.key=="Escape"){
        //         close();
        //     }
        // }, options = {"once": true})

        snackbarProj.scroll(0,0)

        setupZoom()
    }

    // var mouseMovimentoCheck
    // snackbarProj.addEventListener('mousemove', () => {
    //     clearTimeout(mouseMovimentoCheck)
    //     mouseMovimentoCheck = setTimeout(hideIconVisibility, 2000) 
    //     if (closeIcon.style.visibility == "hidden") {
    //         closeIcon.style.visibility = "visible"
    //         closeIconInside.style.visibility = "visible" 
    //     }
    // })

   
    // Close
    document.addEventListener('click', (ev) => {
        close(ev)
    })

    document.addEventListener('keydown', (ev) => {
        if(ev.key == 'Escape'){
            close(ev)
        }
    })
    
    let close = function(ev) {
        if(toClose == 'zoom') {
            closeZoomedObject()
            toClose = 'projeto'
        } else if(toClose == 'projeto') {
            if(ev.type == 'click' && document.getElementById('snackbarProj').contains(ev.target))
                return
                
            closeSnackbarProj()
            toClose = null
        } else {
            console.log('Nada pra fechar')
        }
    }

    let closeZoomedObject = function() {
        document.getElementsByClassName('zoomedContainer')[0].remove()
    }

    let setupZoom = function() {
        zoomObjects = document.getElementsByClassName('snackZoom')
        
        for(zo of zoomObjects) {
            // deletar depois
            let x = Math.floor(500 + 3000 * Math.random())
            let y = Math.floor(500 + 3000 * Math.random())

            zo.addEventListener('click', (ev) => {
                toClose = 'zoom'
                
                ev.stopPropagation()

                let imgSrc = ev.target.src
                
                zoom = document.createElement('div')
                zoom.classList.add('zoomedContainer')

                zoom.innerHTML = `
                    <div id='buttonClose'>
                        <span class='fa fa-times-circle fa-2x' aria-hidden='true'>
                            <span class='closeButtonBackground'></span>
                        </span>
                    </div>
                    <img src="https://placehold.co/${x}x${y}" id="zoomedObject" class="zoomedObject">
                `
                // trocar depois
                // <img src="${imgSrc}" class="zoomedObject">

                document.body.prepend(zoom)
                
                zoomedObject = document.getElementById('zoomedObject')
                
                intervalId = setInterval(() => {
                    console.log(1)
                    if(zoomedObject.complete) {
                        let rect = zoomedObject.getBoundingClientRect()
                        let closePadding = rect.x + rect.width - 20

                        document.getElementById('buttonClose').style.paddingLeft = `${closePadding}px`

                        clearInterval(intervalId)
                    }
                }, 10)
            })
        }
    }
    
    

    // snackbarProj.addEventListener('click', function(event) {
    //     let rect = snackbarProj.getBoundingClientRect()

    //     for (var i = 0; i < snackbarProj.children.length; i++) {
    //         var child = snackbarProj.children[i];    
    //         child.classList.add('hide');   
    //     }
    //     event.target.style.visibility = "visible"
    //     event.target.classList.add('imageOnFocus')
    
    //     let largura = window.innerWidth
    //     let altura = window.innerHeight

    //     snackbarProj.style.maxWidth = "1920px"
    //     snackbarProj.style.maxHeight = "1080px"

    //     snackbarProj.style.background = "black"
    //     dark.style.background = "black"
    //     dark2.style.background = "black"

    //     snackbarProj.style.padding = "0"
    //     snackbarProj.style.top = "0"
    //     snackbarProj.style.bottom = "0"
    //     snackbarProj.style.overflow = "hidden"

    //     snackbarProj.style.width = largura + "px"
    //     snackbarProj.style.height = altura + "px"

    //     event.target.style.width = largura + "px"
    //     event.target.style.height = altura + "px"

    //     let rect2 = event.target.getBoundingClientRect()
    //     closeIcon.style.top = "80px"
    //     closeIcon.style.left = (((rect.x + rect.width)-((rect.width-rect2.width)/2) - 55) + "px") 

    //     flagImageOnFocus = true
    // })
    
    function hideIconVisibility(){
       closeIcon.style.visibility = "hidden"
       closeIconInside.style.visibility = "hidden"
    }

    function closeSnackbarProj(){
        snackbarProj.style.display = "none"  
        dark.style.display= "none"
        dark2.style.display= "none"  
        closeIcon.style.display = 'none'
        snackFiltro.style.display = 'block'
    
        if(window.innerWidth < 980){
            navPanelToggle.style.cssText = ''
        }
        
        document.body.style.cssText = 'overflow: auto'
        document.body.className = 'normal'
    }

    let goToPosition = function (id){
        let capasYPosition = document.getElementById("projetos-list-capas").offsetTop
        let ilustracoesYPosition = document.getElementById("projetos-list-ilustracoes").offsetTop

        if (id == "goToCapas"){
            window.scrollTo({left: 0, top: capasYPosition, behavior: "smooth"})
        }

        if (id == "goToIlustracoes"){
            window.scrollTo({left: 0, top: ilustracoesYPosition, behavior: "smooth"})
        }
    }

    let snackFiltro = document.getElementById('snackbarFiltro')
    let abrir = document.getElementById('abrir')
    let fechar = document.getElementById('fechar')
    let openBar = function(){
        snackFiltro.style.width = '332px'
        snackFiltro.style.display = 'inline-flex'
        abrir.style.display = 'none'
        fechar.style.display = 'block'
    }

    let closeBar = function(){
        snackFiltro.style.width = '103px'
        snackFiltro.style.display = 'block'
        abrir.style.display = 'block'
        fechar.style.display = 'none'
    }

    let checkFlag = function(){
        if (flagProjAberto == true){
            snackFiltro.style.display = 'none'
            navPanelToggle.style.cssText = 'display: none'         
        }
    }
    window.addEventListener('scroll', checkFlag)
    
</script>