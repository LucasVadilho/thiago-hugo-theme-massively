<!-- Footer -->
{{ $data := index .Site.Data .Site.Language.Lang }}
<footer id="footer">
    {{ with $data.contactinfo.contactformaction }}
    <section>
      <form id="contato" method="post" action="{{ . }}">
        <div class="fields">
          <div class="field">
            <label for="name">{{ i18n "CONTACT_FORM_FIELD_NAME" . }}</label>
            <input type="text" name="nome" id="name" required/>
          </div>
          <div class="field">
            <label for="email">{{ i18n "CONTACT_FORM_FIELD_EMAIL" . }}</label>
            <input type="email" name="mail" id="email" />
          </div>
          <div class="field">
            <label for="assunto">{{ i18n "CONTACT_FORM_FIELD_ASSUNTO" . }}</label>
            <input type="text" name="assunto" id="assunto" required/>
          </div>
          <div class="field">
            <label for="message">{{ i18n "CONTACT_FORM_FIELD_MESSAGE" . }}</label>
            <textarea name="mensagem" id="message" rows="3" required></textarea>
          </div>
        </div>
        <ul class="actions">
          <li>
            <input type="submit" id="btn_enviar" value='{{ i18n "CONTACT_FORM_SUBMIT_SEND_MESSAGE" . }}'/>
          </li>
          <div id="loading" style="display: none;">
            <img src=""/>
          </div>
        </ul>
      </form>
      <div id="emailenviado">

      </div>
    </section>
    {{ end }}
    <section class="split contact">
        {{ with $data.contactinfo.email }}
        <section>
            <h3>{{ i18n "CONTACT_EMAIL" . }}</h3>
            <p><a href="mailto:{{ . }}">{{ . }}</a></p>
        </section>
        {{ end }}
        {{ with $data.social }}
        <section>
            <h3>{{ i18n "CONTACT_SOCIAL" . }}</h3>
            <ul class="icons alt">
                <!-- {{ with .twitter}}
                <li><a href="{{ . }}" class="icon alt fa-twitter"><span class="label">Twitter</span></a></li>
                {{ end }} -->
                
                {{ with .behance}}
                <li><a href="{{ . }}" class="icon alt fa-behance"><span class="label">Behance</span></a></li>
                {{ end }}
            </ul>
        </section>
        {{ end }}
    </section>
</footer>

<style>
  #emailenviado{
    color: rgb(0, 131, 7);
    font-weight: 450;
  }
  
</style>

<script>
    document.getElementById('contato').addEventListener("submit", (e) => {		
        e.preventDefault()

        document.getElementById('btn_enviar').setAttribute('disabled', 'a')
        document.getElementById('loading').style.cssText = 'display: true'
        console.log(e.target)
    
        data = Object.fromEntries(new FormData(e.target).entries())
        
        url = 'http://thiago.oioipio.com/contato'

        fetch(url, {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        }).then(result => {
            console.log(result)
            document.getElementById('btn_enviar').removeAttribute('disabled')
            emailenviado()
        }).catch(error => {
            document.getElementById('btn_enviar').removeAttribute('disabled')
            emailnaoenviado()
            console.error(error)
        })
    })

    let emailenviado = function(){
      let emailenviado = document.getElementById('emailenviado')
      emailenviado.innerHTML = "Email enviado!<br>Entrarei em contato assim que possível, obrigado."
      document.getElementById('loading').style.cssText = 'display: none'
      resetfunction()
    }

    let emailnaoenviado = function(){
        let emailenviado = document.getElementById('emailenviado')
        emailenviado.innerHTML = "Infelizmente o email não pode ser enviado. Por favor, tente novamente em alguns instantes"
    }

    let resetfunction = function(){
      let resetform = document.getElementById('contato')
      resetform.reset()
    }
</script>